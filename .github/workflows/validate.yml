name: Validate

on: [push, pull_request]

jobs:
  miri:
    name: Miri

    strategy:
      fail-fast: false
      matrix:
        features:
          - ""
          - --features nightly

    runs-on: ubuntu-latest

    steps:
      - name: Update Rust
        run: |
          rustup toolchain install nightly --profile minimal --component miri,rust-src --allow-downgrade
          rustup default nightly
      - name: Checkout
        uses: actions/checkout@v4
      - name: Test
        run:
          cargo miri test --workspace ${{ matrix.features }} --all-targets --no-fail-fast
